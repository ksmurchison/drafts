<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../../rfc2629.xslt"?>
<!DOCTYPE rfc SYSTEM 'rfc2629.dtd'
[
<!ENTITY rfc2119 PUBLIC '' 'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml'>
<!ENTITY rfc5234 PUBLIC '' 'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5234.xml'>
<!ENTITY rfc4791 PUBLIC '' 'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4791.xml'>
<!ENTITY rfc5545 PUBLIC '' 'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5545.xml'>
<!ENTITY rfc5546 PUBLIC '' 'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5546.xml'>
<!ENTITY rfc5789 PUBLIC '' 'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5789.xml'>
<!ENTITY rfc7953 PUBLIC '' 'http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7953.xml'>
]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc toc="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc tocdepth="3"?>
<?rfc strict="yes"?>
<!-- updates='5545'-->
<rfc category="std" ipr='trust200902'
     docName='draft-daboo-icalendar-vpatch-00'>
  <front>
    <title abbrev="iCalendar VPATCH Component">The iCalendar VPATCH Component</title>
    <author initials="C." surname="Daboo" fullname="Cyrus Daboo">
      <organization abbrev="Apple Inc.">Apple Inc.</organization>
      <address>
        <postal>
          <street>1 Infinite Loop</street>
          <city>Cupertino</city>
          <region>CA</region>
          <code>95014</code>
          <country>USA</country>
        </postal>
        <email>cyrus@daboo.name</email>
        <uri>http://www.apple.com/</uri>
      </address>
    </author>
    <author initials="K." surname="Murchison" fullname="Kenneth Murchison">
      <organization>Carnegie Mellon University</organization>
      <address>
        <postal>
          <street>5000 Forbes Avenue</street>
          <city>Pittsburgh</city> <region>PA</region>
          <code>15213</code> <country>USA</country>
        </postal>
        <!--<phone>+1 412 268 1982</phone>-->
        <email>murch@andrew.cmu.edu</email>
      </address>
    </author>
    <date />
    <area>Applications</area>
    <keyword>calendaring</keyword>
    <keyword>iCalendar</keyword>
    <keyword>iTIP</keyword>
    <keyword>CalDAV</keyword>
    <keyword>HTTP</keyword>
    <keyword>PATCH</keyword>
    <abstract>
      <t>This document defines a new iCalendar (RFC 5545) component
      that allows small "patches" to be applied to large iCalendar data
      objects, to allow for efficient data updates. It also describes
      how this new component can be used with the CalDAV calendar data
      access protocol (RFC 4791).</t>
    </abstract>

    <note title='Open Issues'>
      <t>
        <list style="symbols">
          <t>Does this spec update RFC 5545?  It doesn't touch
          existing elements, so perhaps not.</t>

          <t>Do we want to use "RID=M"to specify "master"
          component (no RECURRENCE-ID) or simply use "RID="?</t>

          <t>Do we have any content for <xref target="defaults"/>?</t>

          <t>Do we need/want to handle individual values in multi-valued
          properties/parameters?</t>

          <t>What media type do we advertise in "Accept-Patch" header?
          Just "text/calendar"?  "text/calendar; component=VPATCH"?  Do
          we need a "patch-version" parameter?</t>
        </list>
      </t>
    </note>
  </front>

  <middle>
    <section title='Introduction'>
      <t>The <xref target='RFC5545'>iCalendar</xref> data format is in
      widespread use to represent calendar data. iCalendar data can
      grow large (e.g., a family calendar containing events over a
      period of several years). Updating large resources over the
      network currently requires the entire data to be sent - even if
      the change itself is minor.</t>

      <t>This specification defines a new iCalendar component that can
      be used to "patch" (incrementally update) iCalendar data in an
      efficient manner. When combined with the HTTP <xref
      target="RFC5789">PATCH method</xref>, it can be used to update
      calendar object resources on a <xref
      target="RFC4791">CalDAV</xref> server, or any resource on an
      HTTP server that contains iCalendar data.</t>
    </section>

    <section title='Conventions Used in This Document'>
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
      "MAY", and "OPTIONAL" in this document are to be interpreted as
      described in <xref target='RFC2119' />.</t> 

      <t>The notation used in this memo is the ABNF notation of <xref
      target='RFC5234' /> as used by <xref
      target='RFC5545'>iCalendar</xref>. Any syntax elements shown
      below that are not explicitly defined in this specification come
      from <xref target='RFC5545'>iCalendar</xref> and
      <xref target='RFC7953'>Calendar Availability</xref>.</t>
<!--
      <xref target='RFC5546'>iTIP</xref>, and
      <xref target='RFC4791'>CalDAV</xref>.</t>

      <t>When XML element types in the namespaces "DAV:" and
      "urn:ietf:params:xml:ns:caldav" are referenced in this document
      outside of the context of an XML fragment, the string "DAV:" and
      "CALDAV:" will be prefixed to the element type names
      respectively.</t>
-->
    </section>

    <section title="Overview" anchor="vpatch-component">
      <t> The basic design of the patch format is a "VPATCH" component (defined in <xref target="vpatch"/>) containing one ot more "PATCH" components (defined in <xref target="patch"/>), each specifying a path (which identifies one or more components in the iCalendar object being patched), and other components and properties that define the set of changes to be made.</t>
      <t>When multiple "VPATCH" components are present in an iCalendar object, the order in which they are applied is defined by the value of any "PATCH-ORDER" properties in the "VPATCH" component. The "VPATCH" components are sorted in order from lowest "PATCH-ORDER" integer value to highest, with any components not containing a "PATCH-ORDER" property placed last. The patch process is then applied in sorted order (any components with the same "PATCH-ORDER" value can be applied in any order).</t>
      <t>No specific processing order is defined for multiple "PATCH" components in a "VPATCH" component.</t>
      <t>The "VPATCH" component also contains an optional "PATCH-VERSION" property to allow future extensions to the format to be recognized. This document only defines version number "1". The "PATCH-VERSION" property only needs to be present if the version number is greater than "1".  If a patch processing engine is unable to handle the indicated version it MUST reject the entire patch operation defined by the enclosing iCalendar object, even if other "VPATCH" components have a "PATCH-VERSION" number that is supported.</t>
      <t>After applying a patch to an iCalendar object, the basic validity of the resulting iCalendar object SHOULD be checked by the processing engine (e.g., if the patch added an extra "DTSTART" property to a "VEVENT" component that would be considered a violation of <xref target="RFC5545"/>'s cardinality rules for the "DTSTART" property in a "VEVENT"). If this occurs, the patch operation MUST fail.</t>
      <t>Other validity constraints can be applied if needed. For example, <xref target="RFC4791">CalDAV</xref> requires that the "UID" property be the same in all components in a calendar object resource stored on the server. If a patch operation adds a component to an iCalendar object with a different "UID" value than the existing components, that result would be an invalid CalDAV calendar object resource. If other validity constraints are violated, the patch operation MUST fail.</t>
      <t>Any failure to process a "VPATCH" component, for whatever reason, MUST result in the entire patch operation being cancelled, with the target iCalendar object left in its original state.</t>
    </section>

    <section title="PATCH Component" anchor="patch-component">
      <t>A "PATCH" component (defined in <xref target="patch"/>) MUST contain one "PATCH-TARGET" property whose value is an iCalendar path (see <xref target="path"/>) that identifies components within the target iCalendar object being patched. The set of patch operations defined by the other components and properties present in the "PATCH" component are then applied to each targeted component (in the order specified below). If a "PATCH-TARGET" property does not match any components in the target iCalendar object, then the patch operation MUST succeed without any changes being applied to the target iCalendar object.</t>
      <t>Four patch operations are supported:
        <list style="numbers">
          <t>Component additions or updates: any components within the "PATCH" component are considered to be additions or updates (see <xref target="patch-components"/>).</t>
          <t>Property additions or updates: any properties (other than those whose name starts with the "PATCH-" prefix) are considered to be additions or updates (see <xref target="patch-properties"/>).</t>
          <t>Component, property, or property parameter deletion: indicated by the present of one or more "PATCH-DELETE" property (see <xref target="patch-delete"/>).</t>
          <t>Property parameter additions or updates: indicated by the presence of one or more "PATCH-PARAMETER" properties (see <xref target="patch-parameters"/>).</t>
        </list>
        When processing a "PATCH" component, the processing engine MUST follow this order:
        <list style="symbols">
          <t>Process all "PATCH-DELETE" properties first.</t>
          <t>Process all "PATCH-PARAMETER" properties second.</t>
          <t>Process all other components third.</t>
          <t>Process all non "PATCH-" prefixed properties fourth.</t>
        </list>
      </t>
    </section>

    <section title="iCalendar Path" anchor="path">
      <t>The "PATCH-TARGET", "PATCH-DELETE", and "PATCH-PARAMETER" property values are all iCalendar "paths". The path is used to match iCalendar elements that the patch operation will be applied to.  The path is a list of "segments" (separated by the "/", "#", ";" or "=" characters) that matches an iCalendar element in the iCalendar object model hierarchy (a component, a property, a property parameter, a property value, or a property parameter value). A path can either be "absolute" (referring to items within the top-level iCalendar object being targeted) or "relative" (referring to items within some other component as determined by the scope of the operation).</t>
      
      <t>A path can start with a series of component segments (which always have a "/" prefix). Those can be followed by a property segment (which always has a "#" prefix"). A property segment can be followed by either a parameter segment (which always has a ";" prefix), or a value segment (which always has a "=" prefix). A parameter segment can be followed by a value segment (which always has a "=" prefix).</t>

      <t>An absolute path always starts with a "/VCALENDAR" component segment since an iCalendar object is always a single "VCALENDAR" component.</t>

      <t>A relative path can start with a component segment or a property segment, with the path assumed to be relative to an enclosing component defined by the context.</t>

      <t>To target a component inside of another component, a component segment is appended to the path. Component segments can include an optional match item.  When present, this allows targeting of components that match a specific "UID" property value, and/or a "RECURRENCE-ID" value (or lack of "RECURRENCE-ID" property to target a "master" recurrence component).</t>

      <t>To target a property inside of a component, a property segment is added to the path. A property segment can include an optional match item. When present, this allows targeting of properties by value (matching or not matching a specific value), or which have a named property parameter present, or by property parameter value (matching or not matching a specific value).</t>

      <t>To target a property parameter, a parameter segment is added to the property segment at the end of the path.  When creating a new property parameter, the parameter segment name is empty.</t>

      <t>To target a single value in a multi-valued property, a value segment is added to the property segment at the end of the path.</t>

      <t>To target a single value in a multi-valued property parameter, a value segment is added to the parameter segment at the end of the path.</t>
      
      <t>Values in match items MUST use URL-style percent (%) encoding of the characters "/", "#", ";", "=", and "]".  This allows a path to be quickly split into segments by breaking apart the text on the relevant delimiter characters.</t>

      <t> 
        The syntax for a path is defined by the following notation (note that some of the syntax elements defined here are not used by this specification, however, it is anticipated that this general path syntax will be useful for other specifications):
        <figure><artwork name="abnf">
abs-path         = abs-comp-path [prop-all-path]
        ; Absolute path for any iCalendar element

rel-full-path    = (comp-path [prop-all-path]) / prop-all-path
        ; Relative path for any iCalendar element at any depth
        ; within the enclosing component

rel-one-path     = comp-path / prop-all-path
        ; Relative path for any iCalendar element immediately
        ; within the enclosing component

abs-comp-path    = "/VCALENDAR" *comp-segment
        ; Absolute path for components only

comp-path        = 1*comp-segment
        ; Path for components only

prop-path        = prop-segment
        ; Relative path for properties only

prop-param-path  = prop-segment [param-segment]
        ; Relative path for property and parameter only

prop-all-path    = prop-segment [param-segment] [value-segment]
        ; Relative path for any element of a property

comp-segment     = "/" name comp-match
comp-match       = [uid-match] [rid-match]
uid-match        = "[UID=" text "]"
rid-match        = "[RID=" ("M" / ridval) "]"
        ; "M" matches "master" component

prop-segment     = prop-prefix [prop-match]
prop-prefix      = "#" name
prop-match       = "[" ( prop-equal / prop-not-equal / param-match ) "]"

prop-equal       = "=" value-escaped
prop-not-equal   = "!" value-escaped

param-match      = "@" param-name [ ( param-equal / param-not-equal ) ]
param-equal      = "=" param-value-escaped
param-not-equal  = "!" param-value-escaped

param-segment    = ";" param-name

value-segment    = "=" (value / param-value)

value-escaped       = value
                    ; % encoding for "/", "#", ";", and "]"

param-value-escaped = param-value
                    ; % encoding for "/", "#", ";", and "]"
</artwork></figure>
      </t>
      <t>Some examples of "path" items follow.</t>
      <t>Targeting components (path contains exactly one or more component segments):
        <list style="hanging">
          <t hangText="/VCALENDAR"><vspace />Targets the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT"><vspace />Targets all "VEVENT" components in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT[UID=1234]"><vspace />Targets any "VEVENT" components that have a "UID" property value exactly equal to "1234", in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT[UID=1234%2F4567][RID=M]"><vspace />Targets any "VEVENT" components that have a "UID" property value exactly equal to "1234/4567" and do not have a "RECURRENCE-ID" property, in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT[UID=1234][RID=20160902T223000Z]"><vspace />Targets any "VEVENT" components that have a "UID" property value exactly equal to "1234" and have a "RECURRENCE-ID" property whose UTC value is "20160902T223000Z", in the "VCALENDAR" component in the iCalendar object.</t>
        </list>
      </t>
      <t>Targeting properties (path contains exactly zero or more component segments, and one property segment):
        <list style="hanging">
          <t hangText="/VCALENDAR/VEVENT#STATUS"><vspace />Targets all "STATUS" properties in all "VEVENT" components in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT[UID=1234]#STATUS"><vspace />Targets all "STATUS" properties in any "VEVENT" components that have a "UID" property value exactly equal to "1234", in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT#ATTENDEE[=mailto:cyrus@example.com]"><vspace />Targets any "ATTENDEE" properties that have the value "mailto:cyrus@example.com" in all  "VEVENT" components, in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT#ATTENDEE[!mailto:cyrus@example.com]"><vspace />Targets any "ATTENDEE" properties that do not have the value "mailto:cyrus@example.com" in all  "VEVENT" components, in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT#ATTENDEE[@MEMBER]"><vspace />Targets any "ATTENDEE" properties that have a "MEMBER" property parameter present in all  "VEVENT" components, in the "VCALENDAR" component in the iCalendar object</t>
          <t hangText="/VCALENDAR/VEVENT#ATTENDEE[@CN=Cyrus Daboo]"><vspace />Targets any "ATTENDEE" properties that have a "CN" property parameter with the value "Cyrus Daboo" present in all "VEVENT" components, in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT#ATTENDEE[@CN!Cyrus Daboo]"><vspace />Targets any "ATTENDEE" properties that have a "CN" property parameter not equal to the value "Cyrus Daboo", or do not have a "CN" property parameter present in all  "VEVENT" components, in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="#ATTENDEE[=mailto:cyrus@example.com]"><vspace />A relative path that targets any "ATTENDEE" properties that have the value "mailto:cyrus@example.com" in all components the path is relative to.</t>
        </list>
      </t>
      <t>Targeting property parameters (path contains exactly zero or more component segments, one property segment, and one parameter segment):
        <list style="hanging">
          <t hangText="/VCALENDAR/VEVENT#ATTENDEE;PARTSTAT"><vspace />Targets the "PARTSTAT" parameter on all "ATTENDEE" properties in all "VEVENT" components in the "VCALENDAR" component in the iCalendar object.</t>
          <t hangText="/VCALENDAR/VEVENT#ATTENDEE[=mailto:cyrus@example.com];PARTSTAT"><vspace />Targets the "PARTSTAT" parameter on any "ATTENDEE" properties that have the value "mailto:cyrus@example.com" in all  "VEVENT" components, in the "VCALENDAR" component in the iCalendar object.</t>
        </list>
      </t>
      <t>Targeting property values (path contains exactly zero or more component segments, one property segment, and one value segment):
        <list style="hanging">
          <t hangText="/VCALENDAR/VEVENT#EXDATE=20160905"><vspace />Targets all "EXDATE" property values with the value "20160905" in all "VEVENT" components in the "VCALENDAR" component in the iCalendar object.</t>
        </list>
      </t>
      <t>Targeting property parameter values (path contains exactly zero or more component segments, one property segment, one parameter segment, and one value segment):
        <list style="hanging">
          <t hangText="/VCALENDAR/VEVENT#ATTENDEE;MEMBER=mailto:group@example.com"><vspace />Targets all "MEMBER" property parameter values with the value "mailto:group@example.com" in all "ATTENDEE" properties in all "VEVENT" components in the "VCALENDAR" component in the iCalendar object.</t>
        </list>
      </t>
    </section>

    <section title="Adding or Updating Components" anchor="patch-components">
      <t>TBD</t>
    </section>

    <section title="Adding or Updating Properties" anchor="patch-properties">
      <t>TBD</t>
    </section>

    <section title="Deleting Components, Properties, or Property Parameters" anchor="patch-delete">
      <t>The "PATCH-DELETE" property (defined in <xref target="patchdelete"/>) is used to indicate deletion of iCalendar elements from the component identified by the "PATCH-TARGET" property in the same "PATCH" component as the "PATCH-DELETE" property. As such, the value of the "PATCH-DELETE" property is always a relative path (see <xref target="path"/>) that refers to an element that is an immediate "child" of the targeted component.</t>
      <t>The following operations are supported:
        <list style="hanging">
          <t hangText="Delete components"> the "PATCH-DELETE" path value targets components only. The matching components are removed from the "parent" target component.</t>
          <t hangText="Properties"> the "PATCH-DELETE" path value targets properties only. The matching properties are removed from the "parent" target component.</t>
          <t hangText="Property parameters"> the "PATCH-DELETE" path value targets property parameters on specific properties only. The matching property parameters are removed from the corresponding property.</t>
          <t hangText="Property values"> the "PATCH-DELETE" path value targets a property value on specific multi-valued properties only. The matching property value is removed from the the corresponding property. If that results in a property with no value, that property is also removed from its "parent" target component.</t>
          <t hangText="Property parameter values"> the "PATCH-DELETE" path value targets a property parameter value on a specific multi-valued property parameter on specific properties only. The matching property parameter value is removed from the the corresponding property parameter. If that results in a property parameter with no value, that property parameter is also removed from from the corresponding property.</t>
        </list>
      </t>
    </section>

    <section title="Adding or Updating Property Parameters" anchor="patch-parameters">
      <t>The "PATCH-PARAMETER" property (defined in <xref target="patchparam"/>) is used to indicate addition or update of property parameters and property parameter values to properties contained in the components identified by the "PATCH-TARGET" property in the same "PATCH" component as the "PATCH-PARAMETER" property. As such, the value of the "PATCH-PARAMETER" property is always a relative path (see <xref target="path"/>) that refers to a property that is an immediate "child" of the targeted component.</t>
      <t>The following operations are supported:
        <list style="hanging">
          <t hangText="Add or update property parameters"> the "PATCH-PARAMETER" path value targets a property only. Any property parameters defined on the "PATCH-PARAMETER" replace the matching parameters on the targeted property, or are added to the targeted property if no matching parameters exist.</t>
          <t hangText="Add a property parameter value"> the "PATCH-PARAMETER" path value targets a multi-valued parameter only. The values in any property parameters defined on the "PATCH-PARAMETER" property are added to the corresponding property parameters of the target properties. If no corresponding property parameter is defined on the target properties, then property parameters are created with the corresponding values.</t>
        </list>
      </t>
    </section>

    <section title='iCalendar Extensions' anchor="extensions">
      <t>This specification adds a new "VPATCH" calendar component to
      iCalendar.  The "VPATCH" component is itself a container for
      a new "PATCH" sub-component.</t>

      <section title="VPATCH Component" anchor="vpatch">
        <t>
          <list style="hanging">
            <t hangText="Component Name:">
              VPATCH
            </t>
            <t hangText="Purpose:">
              Provide a grouping of "PATCH" sub-components
              that describe the patch actions to be performed.
            </t>
            <t hangText="Format Definition:">
              A "VPATCH" calendar component is defined by the
              following notation:
              <figure><artwork name="abnf">
vpatchc     = "BEGIN" ":" "VPATCH" CRLF
                vpatchprop action
              "END" ":" "VPATCH" CRLF

vpatchprop  = *(
                 ;
                 ; The following are REQUIRED,
                 ; but MUST NOT occur more than once.
                 ;
                 dtstamp / uid /
                 ;
                 ;
                 ; The following are OPTIONAL,
                 ; but MUST NOT occur more than once.
                 ;
                 patch-version / patch-order /
                 ;
                 ; The following are OPTIONAL,
                 ; and MAY occur more than once.
                 ;
                 other-prop
                 ;
               )

other-prop  = ( iana-prop / x-prop )

action      = *( patchc / iana-comp / x-comp )
</artwork></figure>
            </t>
            <t hangText="Description:">
              This component serves as a container for a series of
              "PATCH" sub-components, each specifying patch actions
              to be performed on a certain target element in an
              iCalendar object.
            </t>
          </list>
        </t>

        <section title="PATCH Component" anchor="patch">
          <t>
            <list style="hanging">
              <t hangText="Component Name:">
                PATCH
              </t>
              <t hangText="Purpose:">
                Provide a set components, properties, and parameters to be
                added to, deleted from, or updated in the iCalendar object.
              </t>
              <t hangText="Format Definition:">
                A "PATCH" calendar component is defined by the
                following notation:
                <figure><artwork name="abnf">
patchc     = "BEGIN" ":" "PATCH" CRLF
               patchprop subcomp
             "END" ":" "PATCH" CRLF

patchprop  = *(
                 ;
                 ; The following is REQUIRED,
                 ; but MUST NOT occur more than once.
                 ;
                 patchtarget /
                 ;
                 ; The following are OPTIONAL,
                 ; and MAY occur more than once.
                 ;
                 patchdelete / patchparam / other-prop
                 ;
               )

subcomp    = *(
                ;
                ; The following are OPTIONAL,
                ; and MAY occur more than once.
                ;
                eventc / todoc / journalc / freebusyc /
                timezonec / alarmc / standard / daylight /
                availabilityc / availablec /
                iana-comp / x-comp
                ;
             )
</artwork></figure>
              </t>
              <t hangText="Description:">
                This component provides a grouping of patch actions to
                be performed within the scope of a set of components.
                If the PATCH-TARGET property matches one or more
                iCalendar components, then the targeted iCalendar
                components are patched using the remaining properties
                and components.  If there is no iCalendar component
                that matches the PATCH-TARGET property in the
                iCalendar object, the PATCH action MUST succeed
                without any changes being applied to the target
                iCalendar object.
              </t>
            </list>
          </t>
        </section> <!-- PATCH -->
      </section> <!-- VPATCH -->

      <section title="VPATCH Properties" anchor="vpatchprops">
        <t>The VPATCH properties are attributes that apply to the
        VPATCH component, as a whole.  These properties do not appear
        within VPATCH sub-components.  They SHOULD be
        specified after the "BEGIN:VPATCH" delimiter string and prior
        to any sub-component.</t>

        <section title="PATCH-VERSION Property" anchor="patchversion">
          <t>
            <list style="hanging">
              <t hangText="Property Name:">
                PATCH-VERSION
              </t>
              <t hangText="Purpose:">
                This property specifies the identifier corresponding to the
                highest version number of the VPATCH specification
                that is required in order to interpret the VPATCH
                component.
              </t>
              <t hangText="Value Type:">
                INTEGER
              </t>
              <t hangText="Property Parameters:">
                IANA and nonstandard property parameters can be
                specified on this property.
              </t>
              <t hangText="Conformance:">
                This property can be specified once in an VPATCH
                component.  The default value is "1". This property
                MUST be specified if its value is greater than "1".
                Otherwise, this property is OPTIONAL.
              </t>
              <t hangText="Description:">
                A value of "1" corresponds to this memo. See <xref target="vpatch-component"/> for a description of how this property is used.
              </t>
              <t hangText="Format Definition:">
                This property is defined by the following notation:
                <figure><artwork name="abnf">
patch-version  = "PATCH-VERSION pverparam ":" pvervalue CRLF

pverparam      = *(";" other-param)

pvervalue      = "1" / pmaxver
               ; "1" signifies compliance with this memo

pmaxver        = &lt;A IANA-registered VPATCH version&gt;
               ; Maximum VPATCH version needed to parse the VPATCH component.
                </artwork></figure>
              </t>
              <t hangText="Example:">
                The following is an example of this property:
                <figure><artwork name="example">
PATCH-VERSION:1
</artwork></figure>
              </t>
            </list>
          </t>
        </section>

        <section title="PATCH-ORDER Property" anchor="patchorder">
          <t>
            <list style="hanging">
              <t hangText="Property Name:">
                PATCH-ORDER
              </t>
              <t hangText="Purpose:">
                This property specifies the ordering of the associated
                VPATCH component.
              </t>
              <t hangText="Value Type:">
                INTEGER
              </t>
              <t hangText="Property Parameters:">
                IANA and nonstandard property parameters can be
                specified on this property.
              </t>
              <t hangText="Conformance:">
                This property can be specified once in a VPATCH
                component.
              </t>
              <t hangText="Description:">
                This property is OPTIONAL and is used to indicate the relative ordering of the associated VPATCH component amongst its siblings. See <xref target="vpatch-component"/> for a description of how this property is used.
              </t>
              <t hangText="Format Definition:">
                This property is defined by the following notation:
                <figure><artwork name="abnf">
patch-order  = "PATCH-ORDER porderparam ":" integer CRLF

porderparam  = *(";" other-param)
</artwork></figure>
              </t>
              <t hangText="Example:">
                The following is an example of this property:
                <figure><artwork name="example">
PATCH-ORDER:1
</artwork></figure>
              </t>
            </list>
          </t>
        </section>
      </section> <!-- VPATCH Props -->

      <section title='PATCH Component Properties' anchor='patchprops'>
        <t>The following properties can appear within PATCH
        components.</t>

        <section title="PATCH-TARGET Property" anchor="patchtarget">
          <t>
            <list style="hanging">
              <t hangText="Property Name:">
                PATCH-TARGET
              </t>
              <t hangText="Purpose:">
                This property specifies a path targeting one or more
                components within an iCalendar object.
              </t>
              <t hangText="Value Type:">
                TEXT
              </t>
              <t hangText="Property Parameters:">
                IANA and nonstandard property parameters can be
                specified on this property.
              </t>
              <t hangText="Conformance:">
                This property MUST be specified within any PATCH
                sub-component.
              </t>
              <t hangText="Description:">
                This property is used to match iCalendar components that the patch operations will be applied to. The path value is always an absolute path, and interpreted as described in <xref target="path"/>.
              </t>
              <t hangText="Format Definition:">
                This property is defined by the following notation:
                <figure><artwork name="abnf">
patchtarget   = "PATCH-TARGET ptargetparam ":" ptargetpath CRLF

ptargetparam  = *(";" other-param)

ptargetpath   = abs-comp-path
</artwork></figure>
              </t>
              <t hangText="Example:">
                The following is an example of this property:
                <figure><artwork name="example">
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]#DTSTART
</artwork></figure>
              </t>
            </list>
          </t>
        </section>

        <section title="PATCH-DELETE Property" anchor="patchdelete">
          <t>
            <list style="hanging">
              <t hangText="Property Name:">
                PATCH-DELETE
              </t>
              <t hangText="Purpose:">
                This property specifies a path (relative to
                PATCH-TARGET) targeting one or more components,
                properties, or parameters to be removed from the
                iCalendar components targeted by PATCH-TARGET.
              </t>
              <t hangText="Value Type:">
                TEXT
              </t>
              <t hangText="Property Parameters:">
                IANA and nonstandard property parameters can be
                specified on this property.
              </t>
              <t hangText="Conformance:">
                This property can be specified within a PATCH
                sub-component.
              </t>
              <t hangText="Description:">
                This property is used to match iCalendar elements that will be deleted. The path value is always a relative path for only immediate components and properties within the targeted component, and interpreted as described in <xref target="patch-delete"/>.
              </t>
              <t hangText="Format Definition:">
                This property is defined by the following notation:
                <figure><artwork name="abnf">
patchdelete   = "PATCH-DELETE pdeleteparam ":" pdeletepath CRLF

pdeleteparam  = *(";" other-param)

pdeletepath   = rel-one-path
              ; PATCH-DELETE path is relative to PATCH-TARGET path
</artwork></figure>
              </t>
              <t hangText="Example:">
                The following are examples of this property:
                <figure><artwork name="example">
PATCH-DELETE:/VCALENDAR/VEVENT[UID=1234]
PATCH-DELETE:#ATTENDEE[=mailto:cyrus@example.com]
</artwork></figure>
              </t>
            </list>
          </t>
        </section> <!-- DELETE -->

        <section title="PATCH-PARAMETER Property" anchor="patchparam">
          <t>
            <list style="hanging">
              <t hangText="Property Name:">
                PATCH-PARAMETER
              </t>
              <t hangText="Purpose:">
                This property specifies a set of parameters to be
                set on the targeted property.
              </t>
              <t hangText="Value Type:">
                TEXT
              </t>
              <t hangText="Property Parameters:">
                IANA and nonstandard property parameters can be
                specified on this property.
              </t>
              <t hangText="Conformance:">
                This property can be specified within a PATCH
                sub-component.
              </t>
              <t hangText="Description:">
                This property specifies parameters to be set on the targeted property. The path value is always a relative path to a property within the target component, and interpreted as described in <xref target="patch-parameters"/>.
              </t>
              <t hangText="Format Definition:">
                This property is defined by the following notation:
                <figure><artwork name="abnf">
patchparam   = "PATCH-PARAMETER pparamparam ":" pparampath CRLF

pparamparam  = *(";" other-param)

pparampath   = prop-param-path
</artwork></figure>
              </t>
              <t hangText="Example:">
                The following are examples of this property:
                <figure><artwork name="example">
PATCH-PARAMETER;PARTSTAT=NEEDS-ACTION:#ATTENDEE[=mailto:cyrus@example.com]
PATCH-PARAMETER;PARTSTAT=NEEDS-ACTION:#ATTENDEE[@CN=Cyrus Daboo]
PATCH-PARAMETER;MEMBER=mailto:newgroup@example.com:#ATTENDEE;MEMBER
</artwork></figure>
              </t>
            </list>
          </t>
        </section> <!-- PATCH-PARAMETER -->
      </section> <!-- Patch Properties -->

      <section title="PATCH-ACTION Property Parameter" anchor="patchaction">
          <t>
            <list style="hanging">
              <t hangText="Parameter Name:">
                PATCH-ACTION
              </t>
              <t hangText="Purpose:">
                To specify whether the property should be added or
                replaced.
              </t>
              <t hangText="Format Definition:">
                This parameter is defined by the following notation:
                <figure><artwork name="abnf">
pactionparam    = "PATCH-ACTION" "=" pactioncreate / pactionbyname /
                                     pactionbyvalue / pactionbyparam /
                                     x-name

pactioncreate   = "CREATE"
                ; Always add property to target component.

pactionbyname   = "BYNAME"
                ; Always remove properties with the same name
                ; from the target component,
                ; then add this property to the target component.
                ; This value is the default and MAY be omitted.

pactionbyvalue  = "BYVALUE"
                ; Always remove properties with the same name
                ; and value from the target component,
                ; then add this property to the target component.

pactionbyparam  = DQUOTE "BYPARAM" param-match   DQUOTE
                ; Always remove properties with the same name
                ; and parameter name/value from the target component,
                ; then add this property to the target component.
                </artwork></figure>
              </t>
              <t hangText="Description:">
                This parameter can be specified on properties contained in a PATCH component and MUST NOT be specified on properties outside of a PATCH component. This parameter specifies whether the property should be added to the target component or should replace existing properties in the target component.  In the latter case, the parameter also specifies how to match existing properties. The processing of this property parameter is described in <xref target="patch-properties"/>
              </t>
              <t hangText="Examples:">
                The following are examples of this property parameter:
                <figure><artwork name="example">
ATTENDEE;PATCH-ACTION=BYVALUE;PARTSTAT=NEEDS-ACTION:
 mailto:cyrus@example.com
DESCRIPTION;PATCH-ACTION="BYPARAM@LANGUAGE=en_GB";LANGUAGE=en_US:
 Meeting to discuss VPATCH
</artwork></figure>
              </t>
            </list>
          </t>
      </section> <!-- PATCH-ACTION -->
    </section> <!-- Extensions -->

    <section title="Additional Considerations">
      <section title="Handling Default Properties and Parameters"
               anchor="defaults">
        <t></t>
      </section>

      <section title="Handling Recurrences" anchor="recurrences">
        <t>Recurring events in iCalendar are defined by the "RRULE",
        "RDATE", and "EXDATE" properties in a "master" iCalendar
        component. Those rules produce a set of "generated"
        instances. In some cases specific "generated" instances are
        changed, resulting in the presence of "overridden"
        components, which are identified by having the same "UID"
        property value as the "master" component, and a
        "RECURRENCE-ID" property whose value matches the start time
        of the corresponding "generated" instance.</t>

        <t>Patch commands can be used to implicitly create
        "overridden" components in the targeted iCalendar object by
        specifying a path that targets the "generated" instance's
        start time, i.e., what would be the "RECURRENCE-ID" value in
        the "overridden" component.</t>

        <t>Note that if the value of a "RECURRENCE-ID" match item in
        a path does not correspond to an existing instance (either
        because its value does not match a "generated" instance, or
        its value matches an "EXDATE" in the "master" component),
        then the patch operation MUST fail.</t>
        <t>For example, consider the following daily recurring event:
        <figure><artwork>
BEGIN:VCALENDAR
PRODID:test
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160902T120000Z
DURATION:PT1H
SUMMARY:Master component
RRULE:FREQ=DAILY
END:VEVENT
END:VCALENDAR
</artwork></figure>
        The following patch command could be used to update the
        "SUMMARY" property value of the second instance of the
        recurring event (note that the first line of the patch
        command has been split across two lines to fit within the
        margins of this document):
        <figure><artwork>
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234][RID=20160903T120000Z]
SUMMARY:Override second instance
END:PATCH
END:VPATCH
</artwork></figure>
        which results in the following updated iCalendar component:
        <figure><artwork>
BEGIN:VCALENDAR
PRODID:test
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160902T120000Z
DURATION:PT1H
SUMMARY:Master component
RRULE:FREQ=DAILY
END:VEVENT
BEGIN:VEVENT
UID:1234
RECURRENCE-ID=20160903T120000Z
DTSTART:20160903T120000Z
DURATION:PT1H
SUMMARY:Override second instance
END:VEVENT
END:VCALENDAR
</artwork></figure>
        A similar result could have been achieved by using a
        a path targeting the "VCALENDAR" component, and the entire
        "overridden" component supplied as the data. However, the
        implicit override behaviour allows for a more compact
        representation of this type of change.
        </t>

        <t>Note that there is no equivalent behavior when it comes
        to removing "overridden" components from an iCalendar object
        to cancel the instance. In that case, two patch commands are
        required: one to delete the "overridden" component, and one
        to create an "EXDATE" property value to cover the
        cancellation. So, continuing from the example data
        immediately above, the following patch commands would cancel
        the instance that was previously overridden:
        <figure><artwork>
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR
PATCH-DELETE:/VEVENT[UID=1234][RID=20160903T120000Z]
END:PATCH
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234][RID=M]
EXDATE;ACTION=CREATE:20160903T120000Z
END:PATCH
END:VPATCH
</artwork></figure>
        which results in the following updated iCalendar component:
        <figure><artwork>
BEGIN:VCALENDAR
PRODID:test
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160902T120000Z
DURATION:PT1H
SUMMARY:Master component
RRULE:FREQ=DAILY
EXDATE:20160903T120000Z
END:VEVENT
END:VCALENDAR
</artwork></figure>
        </t>
      </section>
      <section title="Folded lines" anchor="folding">
        <t>iCalendar data can contain "folded" lines (as described
        in Section 3.1 of <xref target="RFC5545" />). The patch
        operations described in this specification are a
        "semantic" rather than "syntactic" update to the
        data. i.e., they apply to the underlying object model as
        opposed to the "raw" iCalendar text data. As such, folded
        lines in the iCalendar data targeted by the patch commands
        are not significant. Any iCalendar data supplied as data
        items in a patch command MAY contain folded lines.</t>
      </section>

      <section title="Encoding" anchor="encoding">
        <t>Text values in iCalendar use a backslash escape
        mechanism for certain characters (as described in Section
        3.3.11 <xref target="RFC5545" />). Patch operations apply
        to the escaped form of the iCalendar data. For example, to
        delete a "DESCRIPTION" property that contains an encoded
        line feed character:
        <figure><artwork>
DESCRIPTION:Line one\nLine two
</artwork></figure>
        the following PATCH-DELETE property would be used:
        <figure><artwork>
PATCH-DELETE:#DESCRIPTION[=Line one\nLine two]
</artwork></figure>
        Similarly, to update the "DESCRIPTION" property, the
        following patch command could be used:
        <figure><artwork>
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT
DESCRIPTION:Line one\nLine two\nLine three
END:PATCH
END:VPATCH
</artwork></figure>
        </t>
      </section>

      <section title="Generation" anchor="generation">
        <t>This specification does not define how patch data is generated, as that is likely to be highly dependent on the nature of the implementation. However, it is recommended that patch generators use sets of commands that keep the overall patch data as compact as possible, since one of the goals of this specification is to reduce the size of data needed to do updates. One example is the choice of whether to update an entire property, or just property parameters, when changes are made to just property parameters. In some cases, the data in a property parameter can be large, so repeating that in a full property update may result in larger data than simple using the "PATCH-PARAMETER" property to do an update. On the other hand, if lots of property parameters are being updated or removed, it can be more efficient to update the entire property rather than using lots of "PATCH-PARAMETER" and "PATCH-DELETE" properties.</t>
      </section>
    </section>

    <section title='Use with iTIP'>
      <t><xref target="RFC5546">iTIP</xref> defines how iCalendar data
      can be sent between calendar user agents to schedule calendar
      components between calendar users. This specification does not
      define how iCalendar patch documents can be used with iTIP.</t>
    </section>

    <section title='Use with CalDAV and HTTP'>
      <t>The <xref target="RFC4791">CalDAV</xref> calendar access
      protocol allows clients and servers to exchange iCalendar
      data. iCalendar data is typically stored in calendar object
      resources on a CalDAV server. A CalDAV client typically updates
      the calendar object resource data via an HTTP PUT request, which
      requires sending the entire iCalendar object in the HTTP request
      body.</t>

      <t>A server can also support the HTTP <xref
      target="RFC5789">PATCH method</xref> which allows a patch
      document to be specified in the request body, and for that patch
      document to be applied to the resource targeted by the HTTP
      request. In this case, the server would advertise the
      "text/calendar" media type in an "Accept-Patch" header as
      described in Section 3.1 of <xref target="RFC5789"/>.</t>

      <t>Note that the CREATE sub-component defined by this
      specification does not allow targeting the entire iCalendar
      object, and hence an HTTP PATCH request cannot be used to create
      a new resource (a normal HTTP PUT request is used instead).</t>
    </section>

    <section title='Security Considerations' anchor='security'>
      <t>This specification does not introduce any addition security
      concerns beyond those described in <xref target="RFC5545" />,
      <xref target="RFC5789" />, and <xref target="RFC4791" />.</t>
    </section>

    <section title='Privacy Considerations' anchor='privacy'>
      <t>This specification does not introduce any addition privacy
      concerns beyond those described in <xref target="RFC5545" />,
      <xref target="RFC5789" />, and <xref target="RFC4791" />.</t>
    </section>

    <section title='IANA Considerations'>
      <section title='Component Registrations'>
        <t>This document defines the following new iCalendar
        components to be added to the registry defined in Section
        8.3.1 of <xref target='RFC5545'/>:</t>
        <texttable>
          <ttcol>Component</ttcol>
          <ttcol>Status</ttcol>
          <ttcol>Reference</ttcol>
          <c>VPATCH</c>
          <c>Current</c>
          <c>RFCXXXX, <xref target="vpatch"/></c>
          <c>UPDATE</c>
          <c>Current</c>
          <c>RFCXXXX, <xref target="patch"/></c>
        </texttable>
      </section> <!-- Comp Reg -->

      <section title='Property Registrations'>
        <t>This document defines the following new iCalendar
        properties to be added to the registry defined in Section
        8.3.2 of <xref target='RFC5545'/>:</t>
        <texttable>
          <ttcol>Property</ttcol>
          <ttcol>Status</ttcol>
          <ttcol>Reference</ttcol>
          <c>PATCH-VERSION</c>
          <c>Current</c>
          <c>RFCXXXX, <xref target="patchversion"/></c>
          <c>PATCH-ORDER</c>
          <c>Current</c>
          <c>RFCXXXX, <xref target="patchorder"/></c>
          <c>PATCH-TARGET</c>
          <c>Current</c>
          <c>RFCXXXX, <xref target="patchtarget"/></c>
          <c>PATCH-DELETE</c>
          <c>Current</c>
          <c>RFCXXXX, <xref target="patchdelete"/></c>
          <c>PATCH-PARAMETER</c>
          <c>Current</c>
          <c>RFCXXXX, <xref target="patchparam"/></c>
      </texttable>
      </section> <!-- Prop Reg -->

      <section title='Parameter Registrations'>
        <t>This document defines the following new iCalendar
        parameters to be added to the registry defined in Section
        8.3.3 of <xref target='RFC5545'/>:</t>
        <texttable>
          <ttcol>Property</ttcol>
          <ttcol>Status</ttcol>
          <ttcol>Reference</ttcol>
          <c>PATCH-ACTION</c>
          <c>Current</c>
          <c>RFCXXXX, <xref target="patchaction"/></c>
        </texttable>
      </section> <!-- Param Reg -->

      <section title='Property and Parameter Value Registries'>
        <t>Two new IANA registrys for iCalendar elements have been
        added.  Additional codes MAY be used, provided the process
        described in Section 8.2.1 of <xref target="RFC5545" /> is
        used to register them, using the template in Section 8.2.6 of
        <xref target="RFC5545" />.</t>

        <section title='Patch Version Registry'>
          <t>The following table has been used to initialize the Patch
          Version Registry:</t>
          <texttable>
            <ttcol>Patch Version</ttcol>
            <ttcol>Status</ttcol>
            <ttcol>Reference</ttcol>
            <c>1</c>
            <c>Current</c>
            <c>RFCXXXX</c>
          </texttable>
        </section> <!-- Paction Reg -->

        <section title='Patch Action Registry'>
          <t>The following table has been used to initialize the Patch
          Action Registry:</t>
          <texttable>
            <ttcol>Patch Action</ttcol>
            <ttcol>Status</ttcol>
            <ttcol>Reference</ttcol>
            <c>CREATE</c>
            <c>Current</c>
            <c>RFCXXXX, <xref target="patchaction"/></c>
            <c>BYNAME</c>
            <c>Current</c>
            <c>RFCXXXX, <xref target="patchaction"/></c>
            <c>BYVALUE</c>
            <c>Current</c>
            <c>RFCXXXX, <xref target="patchaction"/></c>
            <c>BYPARAM</c>
            <c>Current</c>
            <c>RFCXXXX, <xref target="patchaction"/></c>
          </texttable>
        </section> <!-- Paction Reg -->
      </section> <!-- Param value Reg -->
    </section> <!-- IANA -->

    <section title='Acknowledgments'>
      <t>Thanks to the following for feedback:
      </t>
      <t>
        This specification originated from work at the Calendaring and
        Scheduling Consortium, which has helped with the development
        and testing of implementations.
      </t>
    </section>
  </middle>

  <back>
    <references title='Normative References'>
    &rfc2119;
    &rfc4791;
    &rfc5234;
    &rfc5545;
    &rfc5546;
    &rfc5789;
    &rfc7953;
    </references>

<!--
    <references title='Informative References'>
    </references>
-->
    
<!--
    <section
      title="Change History (To be removed by RFC Editor before publication)">
      <t>Changes in draft-daboo-icalendar-vpatch-01: 
      <list style='numbers'>
        <t></t>
      </list>
      </t>
    </section>
-->

    <section title="VPATCH Examples">
      <t>Examples of single command patch documents for common
      iCalendar data operations.</t>

      <section title="Add a new component">
        <t>Creates a new "VEVENT" component.</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR
BEGIN:VEVENT
UID:1234
DTSTART:20160902T103000Z
DURATION:PT1H
SUMMARY:Test event
END:VEVENT
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Add a new VALARM component">
        <t>Creates a new "VALARM" component in the "VEVENT" component
        with the "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
BEGIN:VALARM
UID:4567
ACTION:DISPLAY
TRIGGER:-PT30M
DESCRIPTION:Time to leave
END:VALARM
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Replace a component">
        <t>Replace the "VEVENT" component with the "UID" property
        value "1234" with a new component.</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
BEGIN:VEVENT
UID:1234
DTSTART:20160903T123000Z
DURATION:PT2H
SUMMARY:Changed event
END:VEVENT
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Remove a component">
        <t>Remove the "VEVENT" component with the "UID" property value
        "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR
PATCH-DELETE:/VEVENT[UID=1234]
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Add properties to a component">
        <t>Add "STATUS" and "COMPLETED" properties to the "VTODO"
        component with the "UID" property value "4321".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VTODO[UID=4321]
STATUS;ACTION=CREATE:COMPLETED
COMPLETED;ACTION=CREATE:20160902T224515Z
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Update properties in a component">
        <t>Update the "SUMMARY" and "LOCATION" properties in the
        "VEVENT" component with the "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
SUMMARY:Title was changed
LOCATION:New place
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Update a targeted property in a component">
        <t>Update the "ATTENDEE" property with value
        "mailto:cyrus@example.com" in the "VEVENT" component with the
        "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
ATTENDEE;ACTION=BYVALUE;PARTSTAT=ACCEPTED:mailto:cyrus@example.com
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Remove a property from a component">
        <t>Remove the "URL" property from the "VEVENT" component with
        the "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
PATCH-DELETE:#URL
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Remove a property with a specific value from a component">
        <t>Remove the "ATTENDEE" property with the value
        "mailto:cyrus@example.com" in the "VEVENT" component with the
        "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
PATCH-DELETE:#ATTENDEE[=mailto:cyrus@example.com]
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Change a parameter on a property with a specific
                      value from a component"> 
        <t>Change or add the "PARTSTAT" parameter on the "ATTENDEE"
        property with the value "mailto:cyrus@example.com" in the
        "VEVENT" component with the "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
PATCH-PARAMETER;PARTSTAT=ACCEPTED:#ATTENDEE[=mailto:cyrus@example.com]
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Remove a parameter on a property with a specific
                      value from a component"> 
        <t>Remove the "PARTSTAT" parameter from the "ATTENDEE"
        property with the value "mailto:cyrus@example.com" in the
        "VEVENT" component with the "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
PATCH-DELETE:#ATTENDEE[=mailto:cyrus@example.com];PARTSTAT
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Remove a value from a multi-valued parameter on
                      a property with a specific value from a component"> 
        <t>Remove the "mailto:calext@example.com" value from the "MEMBER"
        parameter on the "ATTENDEE"
        property with the value "mailto:cyrus@example.com" in the
        "VEVENT" component with the "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
PATCH-DELETE:#ATTENDEE[=mailto:cyrus@example.com]
 ;MEMBER=mailto:calext@example.com
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

<!-- We do not support this operation right now

      <section title="Add a value to a multi-valued property in a component">
        <t>Add a new value to the "EXDATE" property in the "VEVENT"
        component with the "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
EXDATE;ACTION=CREATE-VALUE:20160903T120000Z
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>
-->

      <section title="Remove a value from a multi-valued property from
                      a component">
        <t>Remove the value "20160903T120000Z" from the "EXDATE" property in the "VEVENT"
        component with the "UID" property value "1234".</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[UID=1234]
PATCH-DELETE:#EXDATE=20160903T120000Z
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Attendee updating their participation status">
        <t>When an attendee updates their participation status in an
        event, they will typically: update the "PARTSTAT" parameter on
        their "ATTENDEE" property, remove the "RSVP" parameter on
        their "ATTENDEE" property, update the "TRANSP" property in the
        "VEVENT" component. This set of changes is shown below in a
        single "PATCH" component, with the attendee having the
        calendar user address "mailto:cyrus@example.com". The patch
        targets all "VEVENT" components in the iCalendar object being
        changed.</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT
PATCH-DELETE:#ATTENDEE[=mailto:cyrus@example.com];RSVP
PATCH-PARAMETER;PARTSTAT=ACCEPTED:#ATTENDEE[=mailto:cyrus@example.com]
TRANSP:OPAQUE
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>
      <section title="Recurring event adding one override">
        <t>A daily recurring "VEVENT" component with the "SUMMARY"
        property being overridden for the second instance.</t>
        <t>
        <figure>
          <preamble>iCalendar object before the patch:</preamble>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160905
DURATION:PT1H
SUMMARY:Test event
RRULE:FREQ=DAILY
END:VEVENT
END:VCALENDAR
]]></artwork>
            </figure>
        <figure>
          <preamble>Patch:</preamble>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[RID=20160906]
SUMMARY:Test event - modified
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure>
        <figure>
          <preamble>iCalendar object after the patch:</preamble>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160905
DURATION:PT1H
SUMMARY:Test event
RRULE:FREQ=DAILY
END:VEVENT
BEGIN:VEVENT
UID:1234
RECURRENCE-ID:20160906
DTSTART:20160905
DURATION:PT1H
SUMMARY:Test event - modified
END:VEVENT
END:VCALENDAR
]]></artwork>
            </figure>
        </t>
      </section>
      <section title="Removal of an overriden instance">
        <t>A daily recurring "VEVENT" component has one existing instance override removed with an "EXDATE" added for it.</t>
        <t>
        <figure>
          <preamble>iCalendar object before the patch:</preamble>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160905
DURATION:PT1H
SUMMARY:Test event
RRULE:FREQ=DAILY
END:VEVENT
BEGIN:VEVENT
UID:1234
RECURRENCE-ID:20160906
DTSTART:20160905
DURATION:PT1H
SUMMARY:Test event - modified
END:VEVENT
END:VCALENDAR
]]></artwork>
            </figure>
        <figure>
          <preamble>Patch:</preamble>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VPATCH
UID:abcd
DTSTAMP:20160901T000000Z
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR
PATCH-DELETE:/VEVENT[RID=20160906]
END:PATCH
BEGIN:PATCH
PATCH-TARGET:/VCALENDAR/VEVENT[RID=M]
EXDATE;PATCH-ACTION=CREATE:20160906
END:PATCH
END:VPATCH
END:VCALENDAR
]]></artwork>
            </figure>
        <figure>
          <preamble>iCalendar object after the patch:</preamble>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160905
DURATION:PT1H
SUMMARY:Test event
RRULE:FREQ=DAILY
EXDATE:20160906
END:VEVENT
END:VCALENDAR
]]></artwork>
            </figure>
        </t>
      </section>
    </section>
<!--
    <section title="Recurrence Examples">
      <t>Examples of recurring events using a patch to represent
      recurrence overrides.</t>
      <section title="Daily with one override">
        <t>A daily recurring "VEVENT" component with the "SUMMARY"
        property overridden for the second instance.</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160902T103000Z
DURATION:PT1H
SUMMARY:Test event
RRULE:FREQ=DAILY
END:VEVENT
BEGIN:VINSTANCE
UID:1234
RECURRENCE-ID:20160903T103000Z
BEGIN:PROPERTYUPDATE
SUMMARY:Test event
END:PROPERTYUPDATE
END:VINSTANCE
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Daily with one alarm override">
        <t>A daily recurring "VEVENT" component with a different alarm
        for the second instance.</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160902T103000Z
DURATION:PT1H
SUMMARY:Test event
RRULE:FREQ=DAILY
BEGIN:VALARM
UID:4567
ACTION:DISPLAY
TRIGGER:-PT30M
DESCRIPTION:30 minutes before meeting
END:VALARM
END:VEVENT
BEGIN:VINSTANCE
UID:1234
RECURRENCE-ID:20160903T103000Z
PATCH-TARGET:VALARM[UID=4567]
BEGIN:COMPONENTUPDATE
BEGIN:VALARM
UID:4567
ACTION:DISPLAY
TRIGGER:-PT10M
DESCRIPTION:10 minutes before meeting
END:VALARM
END:COMPONENTUPDATE
END:VINSTANCE
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Daily with two overrides due to Attendee status differences">
        <t>A daily recurring "VEVENT" component with various
        "ATTENDEE" properties overridden for the second and third
        instances, reflecting different attendees' ability to
        participate. In this case, the attendee "mike@example.com" has
        declined the second instance only, and the attendee
        "dave@example.com" has declined the third instance only.</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160902T103000Z
DURATION:PT1H
SUMMARY:Test event
RRULE:FREQ=DAILY
ORGANIZER:mailto:cyrus@example.com
ATTENDEE;PARTSTAT=ACCEPTED:mailto:cyrus@example.com
ATTENDEE;PARTSTAT=ACCEPTED:mailto:mike@example.com
ATTENDEE;PARTSTAT=ACCEPTED:mailto:dave@example.com
END:VEVENT
BEGIN:VINSTANCE
UID:1234
RECURRENCE-ID:20160903T103000Z
BEGIN:PROPERTYUPDATE
ATTENDEE;PARTSTAT=DECLINED:mailto:mike@example.com
END:PROPERTYUPDATE
END:VINSTANCE
BEGIN:VINSTANCE
UID:1234
RECURRENCE-ID:20160904T103000Z
BEGIN:PROPERTYUPDATE
ATTENDEE;PARTSTAT=DECLINED:mailto:dave@example.com
END:PROPERTYUPDATE
END:VINSTANCE
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>

      <section title="Daily with two overrides due to Attendee additions and removals">
        <t>A daily recurring "VEVENT" component with various
        "ATTENDEE" properties added or removed from the second and
        third instances, reflecting different attendees' ability to
        participate. In this case, the attendee "ken@example.com" has
        been added to the second instance only, and the attendee
        "dave@example.com" has been removed from the third instance
        only.</t>
        <t><figure>
              <artwork><![CDATA[
BEGIN:VCALENDAR
PRODID:Example
VERSION:2.0
BEGIN:VEVENT
UID:1234
DTSTART:20160902T103000Z
DURATION:PT1H
SUMMARY:Test event
RRULE:FREQ=DAILY
ORGANIZER:mailto:cyrus@example.com
ATTENDEE;PARTSTAT=ACCEPTED:mailto:cyrus@example.com
ATTENDEE;PARTSTAT=ACCEPTED:mailto:mike@example.com
ATTENDEE;PARTSTAT=ACCEPTED:mailto:dave@example.com
END:VEVENT
BEGIN:VINSTANCE
UID:1234
RECURRENCE-ID:20160903T103000Z
BEGIN:PROPERTYCREATE
ATTENDEE;PARTSTAT=ACCEPTED:mailto:ken@example.com
END:PROPERTYCREATE
END:VINSTANCE
BEGIN:VINSTANCE
UID:1234
RECURRENCE-ID:20160904T103000Z
BEGIN:PROPERTYDELETE
ATTENDEE:mailto:dave@example.com
END:PROPERTYDELETE
END:VINSTANCE
END:VCALENDAR
]]></artwork>
            </figure></t>
      </section>
-->
  </back>
</rfc>
